<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>酒サーチ アーキテクチャ図</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true });</script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .diagram-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>酒サーチ MVP アーキテクチャ図</h1>

    <h2>システム全体構成</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TB
    subgraph "Client (Browser)"
        UI[React UI Components]
        State[State Management<br/>useState hooks]
    end

    subgraph "Next.js Application"
        subgraph "Frontend"
            Pages[Pages<br/>app/page.tsx]
            Components[Components<br/>- SearchSection<br/>- TasteChart<br/>- SakeDetail<br/>- ComparisonPanel]
            Styles[Styling<br/>Tailwind CSS]
        end

        subgraph "Backend"
            SA[Server Actions<br/>app/actions/search.ts]
            Lib[Libraries<br/>- sakenowaApi.ts<br/>- mockData.ts]
        end
    end

    subgraph "External Services"
        Sakenowa[Sakenowa API<br/>https://muro.sakenowa.com]
    end

    UI --> State
    State --> Pages
    Pages --> Components
    Components --> Styles
    
    Pages --> SA
    SA --> Lib
    Lib --> Sakenowa

    classDef client fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef frontend fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef backend fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class UI,State client
    class Pages,Components,Styles frontend
    class API,Lib backend
    class Sakenowa external
        </div>
    </div>

    <h2>データフロー</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant User
    participant UI as UI Components
    participant State as React State
    participant SA as Server Action
    participant Lib as sakenowaApi.ts
    participant Sakenowa as Sakenowa API
    participant Mock as mockData.ts

    User->>UI: 日本酒名を入力
    UI->>State: handleSearch(query)
    State->>SA: searchSakesAction({ query })
    
    alt Sakenowa API使用時
        SA->>Lib: searchRealSakeData(query)
        Lib->>Sakenowa: fetch(/brands, /breweries, /flavor-charts)
        Sakenowa-->>Lib: APIレスポンス
        Lib-->>SA: 変換されたSakeData[]
    else モックデータ使用時
        SA->>Mock: searchMockSakeData(query)
        Mock-->>SA: モックSakeData[]
    end
    
    SA-->>State: SearchResult
    State->>UI: データ更新
    UI->>User: チャートと詳細表示
        </div>
    </div>

    <h2>コンポーネント構成</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "app/page.tsx"
        Home[Home Component<br/>- 全体レイアウト<br/>- 状態管理]
    end

    subgraph "Components"
        Search[SearchSection<br/>- 検索UI<br/>- 検索処理]
        Chart[TasteChart<br/>- 4象限グラフ<br/>- Chart.js統合<br/>- ラベルプラグイン]
        Detail[SakeDetail<br/>- 詳細情報表示<br/>- 味覚プロファイル]
        Compare[ComparisonPanel<br/>- 比較モード管理<br/>- 選択済み表示]
    end

    Home --> Search
    Home --> Chart
    Home --> Detail
    Home --> Compare

    classDef page fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef component fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    
    class Home page
    class Search,Chart,Detail,Compare component
        </div>
    </div>

    <h2>主要な技術スタック</h2>
    <table>
        <tr>
            <th>レイヤー</th>
            <th>技術</th>
            <th>用途</th>
        </tr>
        <tr>
            <td>フレームワーク</td>
            <td>Next.js 15.4.5</td>
            <td>SSR, API Routes, ルーティング</td>
        </tr>
        <tr>
            <td>UI ライブラリ</td>
            <td>React 19</td>
            <td>コンポーネントベースUI</td>
        </tr>
        <tr>
            <td>言語</td>
            <td>TypeScript</td>
            <td>型安全性</td>
        </tr>
        <tr>
            <td>スタイリング</td>
            <td>Tailwind CSS</td>
            <td>ユーティリティファーストCSS</td>
        </tr>
        <tr>
            <td>グラフ描画</td>
            <td>Chart.js</td>
            <td>散布図による4象限チャート</td>
        </tr>
        <tr>
            <td>外部API</td>
            <td>Sakenowa API</td>
            <td>日本酒データ取得</td>
        </tr>
        <tr>
            <td>開発ツール</td>
            <td>ESLint, PostCSS</td>
            <td>コード品質, CSS処理</td>
        </tr>
    </table>

    <h2>主要機能とファイル対応</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    subgraph "機能"
        F1[日本酒検索]
        F2[4象限チャート表示]
        F3[詳細情報表示]
        F4[複数比較機能]
        F5[API統合]
    end

    subgraph "実装ファイル"
        File1[SearchSection.tsx]
        File2[TasteChart.tsx]
        File3[SakeDetail.tsx]
        File4[ComparisonPanel.tsx]
        File5[sakenowaApi.ts]
    end

    F1 --> File1
    F2 --> File2
    F3 --> File3
    F4 --> File4
    F5 --> File5

    classDef feature fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef file fill:#e8eaf6,stroke:#283593,stroke-width:2px
    
    class F1,F2,F3,F4,F5 feature
    class File1,File2,File3,File4,File5 file
        </div>
    </div>
</body>
</html>
