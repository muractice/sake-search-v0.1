# STEP4: 記録管理機能 要件定義書

## 1. 概要

### 目的
「自分で飲んだ日本酒を後から思い出せる、サービスを継続して活用する」ことを実現する記録管理機能を実装する。

### 解決したい課題（ペイン）
- 飲んだお酒がどんなだったか大体覚えていない
- 同じ日本酒を再度飲んでしまう、または気に入った日本酒を忘れてしまう
- 日本酒を飲む体験の蓄積が実感できない
- サービスを継続的に使う動機が弱い

### ゲインポイント
- 過去の飲酒体験を簡単に振り返れる
- 自分の日本酒体験の広がりを可視化できる
- ゲーミフィケーション要素により継続的な利用が楽しくなる
- お気に入り情報と連携してレコメンド精度が向上

## 2. 機能要件

### 2.1 飲酒記録機能

#### 基本記録項目
- **必須項目**
  - 日本酒名（検索・選択式）
  - 飲んだ日付（デフォルト：当日）
  - 評価（5段階の星評価）

- **任意項目**
  - 飲んだ場所（自宅/飲食店/その他）
  - 飲食店名（飲食店の場合）
  - 価格（グラス/一合/ボトル）
  - 飲み方（冷酒/常温/ぬる燗/熱燗）
  - ペアリング（一緒に食べた料理）
  - 写真（最大3枚）
  - メモ（自由記述、最大500文字）

#### 味覚評価（選択式）
- 甘辛度（5段階：甘い～辛い）
- 濃淡度（5段階：あっさり～濃厚）
- 香り（5段階：控えめ～華やか）
- キレ（5段階：まろやか～キレがある）
- 総合満足度（5段階星評価）

### 2.2 記録の表示・管理

#### 一覧表示
- タイムライン形式（新しい順）
- カレンダー形式（月別表示）
- 日本酒別グループ表示
- 飲食店別グループ表示

#### フィルタリング・検索
- 期間指定（今月/過去3ヶ月/過去1年/全期間）
- 評価別（星評価でフィルター）
- 場所別（自宅/飲食店）
- 日本酒名検索
- メモ内容検索

#### 記録の編集・削除
- 記録の編集（全項目編集可能）
- 記録の削除（確認ダイアログ付き）
- 一括削除機能（複数選択）

### 2.3 統計・可視化機能

#### 飲酒統計
- 総飲酒記録数
- 飲んだ銘柄数（ユニーク数）
- 飲んだ酒蔵数
- 月別・週別の飲酒回数グラフ
- 好みの傾向分析（味覚チャート）

#### 都道府県マップ
- 飲んだ日本酒の産地を地図上に表示
- 都道府県別の銘柄数表示
- 全国制覇率（47都道府県中の達成数）
- 未開拓エリアのハイライト

### 2.4 ゲーミフィケーション要素

#### バッジ・実績システム
- **記録数バッジ**
  - 初記録（1件）
  - ビギナー（10件）
  - レギュラー（50件）
  - ヘビーユーザー（100件）
  - マスター（500件）
  - レジェンド（1000件）

- **銘柄数バッジ**
  - 探求者（10銘柄）
  - 冒険者（50銘柄）
  - エキスパート（100銘柄）
  - ソムリエ（300銘柄）

- **地域制覇バッジ**
  - 地元通（1都道府県制覇）
  - 地方通（1地方制覇）
  - 全国通（全都道府県制覇）

- **特殊バッジ**
  - 連続記録（7日/30日/100日）
  - 季節限定酒マスター
  - 高評価マスター（★5を50件以上）

#### レベルシステム
- 記録数に応じたレベルアップ
- レベルごとの称号付与
- プロフィールでのレベル表示

### 2.5 お気に入りとの連携

- 記録から直接お気に入り登録
- 高評価（★4以上）の自動お気に入り提案
- お気に入りベースのレコメンド精度向上

### 2.6 共有機能

- 記録の個別シェア（SNS連携）
- 月間/年間サマリーの生成・共有
- バッジ獲得時の共有

## 3. 非機能要件

### 3.1 パフォーマンス
- 記録一覧の表示：2秒以内
- 記録の保存：1秒以内
- 統計情報の生成：3秒以内

### 3.2 データ保存
- 画像はSupabase Storageに保存
- 記録データはSupabaseに保存
- オフライン時の一時保存機能（localStorage）

### 3.3 セキュリティ
- ユーザーごとのデータ分離
- 他ユーザーの記録は閲覧不可
- 画像アップロードのサイズ制限（5MB/枚）

## 4. UI/UXデザイン方針

### 4.1 記録作成の簡便性
- ワンタップで基本記録開始
- 日本酒名の予測入力
- よく飲む日本酒のクイック選択
- 前回の記録をテンプレート化

### 4.2 視覚的な楽しさ
- 写真中心のタイムライン表示
- アニメーション付きのバッジ獲得
- インタラクティブな都道府県マップ
- 美しいグラフ表示

### 4.3 モバイルファースト
- スマホでの入力最適化
- スワイプ操作対応
- カメラ連携の最適化

## 5. データベース設計（概要）

### drinking_records テーブル
```sql
- id: UUID
- user_id: UUID (FK)
- sake_id: VARCHAR (FK)
- date: DATE
- location_type: ENUM('home', 'restaurant', 'other')
- restaurant_name: VARCHAR
- price: INTEGER
- serving_style: ENUM('cold', 'room', 'warm', 'hot')
- pairing: TEXT
- rating: INTEGER (1-5)
- sweetness: INTEGER (1-5)
- richness: INTEGER (1-5)
- aroma: INTEGER (1-5)
- sharpness: INTEGER (1-5)
- memo: TEXT
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### record_images テーブル
```sql
- id: UUID
- record_id: UUID (FK)
- image_url: VARCHAR
- order: INTEGER
- created_at: TIMESTAMP
```

### user_badges テーブル
```sql
- id: UUID
- user_id: UUID (FK)
- badge_type: VARCHAR
- badge_level: VARCHAR
- earned_at: TIMESTAMP
```

### user_statistics テーブル
```sql
- user_id: UUID (PK)
- total_records: INTEGER
- unique_brands: INTEGER
- unique_breweries: INTEGER
- prefectures_visited: JSON
- current_level: INTEGER
- current_streak: INTEGER
- updated_at: TIMESTAMP
```

## 6. 実装優先順位

### Phase 1（MVP）- 2週間
1. 基本的な記録作成機能
2. 記録一覧表示（タイムライン形式）
3. 記録の編集・削除
4. 基本的な統計表示（記録数、銘柄数）

### Phase 2（拡張）- 2週間
1. 写真アップロード機能
2. カレンダー表示
3. 都道府県マップ
4. フィルタリング・検索機能

### Phase 3（ゲーミフィケーション）- 1週間
1. バッジシステム
2. レベルシステム
3. 連続記録カウント
4. 共有機能

### Phase 4（分析強化）- 1週間
1. 詳細な統計グラフ
2. 好みの傾向分析
3. お気に入りとの連携強化
4. レコメンド精度向上

## 7. 技術スタック

### フロントエンド
- Next.js 15（既存）
- TypeScript（既存）
- Tailwind CSS（既存）
- Chart.js or Recharts（グラフ表示）
- React-Calendar（カレンダー表示）
- Japan Map React（都道府県マップ）

### バックエンド
- Next.js API Routes（既存）
- Supabase（既存）
  - Database: 記録データ
  - Storage: 画像保存
  - Auth: ユーザー認証（既存）

### 追加ライブラリ候補
- react-dropzone（画像アップロード）
- date-fns（日付処理）
- framer-motion（アニメーション）
- react-share（SNS共有）

## 8. 成功指標（KPI）

### 定量指標
- MAU（月間アクティブユーザー）20%向上
- 平均記録数/ユーザー：月10件以上
- 継続率：3ヶ月後50%以上
- バッジ獲得率：ユーザーの80%が最低1つ獲得

### 定性指標
- ユーザーフィードバックの改善
- 記録機能の使いやすさ評価
- ゲーミフィケーション要素の楽しさ評価

## 9. リスクと対策

### リスク
1. **データ量増大によるパフォーマンス低下**
   - 対策：ページネーション、インデックス最適化

2. **画像ストレージコストの増大**
   - 対策：画像圧縮、容量制限、古い画像の自動削除オプション

3. **複雑なUIによる使いづらさ**
   - 対策：段階的な機能追加、ユーザーテスト実施

4. **プライバシー懸念**
   - 対策：公開範囲設定、デフォルト非公開

## 10. 今後の拡張可能性

- SNS機能（フォロー、いいね、コメント）
- 飲食店との連携（チェックイン機能）
- AIによる味の好み予測
- 日本酒サブスクとの連携
- オフ会・イベント機能