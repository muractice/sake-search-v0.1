# 酒サーチ MVP アーキテクチャ設計

## システム全体図

```
┌─────────────────────────────────────────────────────────────────┐
│                        クライアント層                            │
├─────────────────────────────────────────────────────────────────┤
│  [Webブラウザ]                                                  │
│  ├── HTML/CSS (UI)                                             │
│  ├── JavaScript (ロジック)                                      │
│  └── Chart.js (グラフ描画)                                      │
└─────────────────────────────────────────────────────────────────┘
                                   │
                                   │ HTTPS
                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                        CDN/ホスティング層                        │
├─────────────────────────────────────────────────────────────────┤
│  [Vercel CDN]                                                  │
│  ├── 静的ファイル配信                                           │
│  ├── キャッシュ最適化                                           │
│  └── GZIP圧縮                                                  │
└─────────────────────────────────────────────────────────────────┘
                                   │
                                   │ Function API Call
                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                      サーバーレス関数層                          │
├─────────────────────────────────────────────────────────────────┤
│  [Vercel Functions]                                            │
│  ├── /api/search - 酒検索API                                   │
│  ├── /api/suggest - サジェストAPI                              │
│  └── リクエスト処理・レスポンス生成                              │
└─────────────────────────────────────────────────────────────────┘
                                   │
                                   │ File System Read
                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                        データストレージ層                        │
├─────────────────────────────────────────────────────────────────┤
│  [静的JSONファイル]                                             │
│  ├── sake_data.json (日本酒マスターデータ)                      │
│  ├── metadata.json (メタデータ)                                │
│  └── GitHub Repository (バージョン管理)                        │
└─────────────────────────────────────────────────────────────────┘
```

## レイヤード アーキテクチャ

### 1. プレゼンテーション層
```
┌─────────────────────────────────────────┐
│            Presentation Layer           │
├─────────────────────────────────────────┤
│  Components:                           │
│  ├── SearchComponent                   │
│  │   ├── input field                   │
│  │   ├── search button                 │
│  │   └── autocomplete                  │
│  ├── ChartComponent                    │
│  │   ├── 4-quadrant plot               │
│  │   ├── axis labels                   │
│  │   └── interactive dots              │
│  └── DetailComponent                   │
│      ├── sake information              │
│      ├── brewery details               │
│      └── taste description             │
└─────────────────────────────────────────┘
```

### 2. アプリケーション層
```
┌─────────────────────────────────────────┐
│           Application Layer             │
├─────────────────────────────────────────┤
│  Services:                             │
│  ├── SearchService                     │
│  │   ├── searchSake()                  │
│  │   ├── getSuggestions()              │
│  │   └── filterResults()               │
│  ├── ChartService                      │
│  │   ├── plotSakeOnChart()             │
│  │   ├── calculatePosition()           │
│  │   └── handleInteraction()           │
│  └── DataService                       │
│      ├── loadSakeData()                │
│      ├── cacheManagement()             │
│      └── errorHandling()               │
└─────────────────────────────────────────┘
```

### 3. API層
```
┌─────────────────────────────────────────┐
│               API Layer                 │
├─────────────────────────────────────────┤
│  Endpoints:                            │
│  ├── GET /api/search                    │
│  │   ├── query parameter               │
│  │   ├── fuzzy matching                │
│  │   └── JSON response                 │
│  ├── GET /api/suggest                   │
│  │   ├── partial text input            │
│  │   ├── top 5 suggestions             │
│  │   └── fast response                 │
│  └── GET /api/sake/:id                  │
│      ├── sake detail                   │
│      ├── complete information          │
│      └── error handling                │
└─────────────────────────────────────────┘
```

### 4. データ層
```
┌─────────────────────────────────────────┐
│              Data Layer                 │
├─────────────────────────────────────────┤
│  Storage:                              │
│  ├── sake_data.json                    │
│  │   ├── 30+ sake records             │
│  │   ├── taste coordinates             │
│  │   └── meta information             │
│  ├── search_index.json                 │
│  │   ├── indexed sake names           │
│  │   ├── brewery names                │
│  │   └── fast lookup                  │
│  └── Cache Layer                       │
│      ├── browser cache                 │
│      ├── CDN cache                     │
│      └── function cache                │
└─────────────────────────────────────────┘
```

## コンポーネント設計

### フロントエンド コンポーネント構造

```
App
├── Header
│   ├── Logo
│   └── Navigation
├── SearchSection
│   ├── SearchInput
│   ├── SearchButton
│   └── SuggestionList
├── ChartSection
│   ├── QuadrantChart
│   │   ├── AxesComponent
│   │   ├── GridComponent
│   │   ├── SakeDotsComponent
│   │   └── InteractionHandler
│   └── ChartLegend
├── DetailSection
│   ├── SakeDetail
│   ├── BreweryInfo
│   └── TasteProfile
└── Footer
    ├── Copyright
    └── Links
```

### バックエンド サービス構造

```
API Services
├── SearchAPI
│   ├── textSearch()
│   ├── fuzzyMatch()
│   └── rankResults()
├── SuggestionAPI
│   ├── getPartialMatches()
│   ├── sortByPopularity()
│   └── limitResults()
└── DataAPI
    ├── loadJSONData()
    ├── validateData()
    └── cacheData()
```

## データフロー設計

### 1. 検索フロー
```
[ユーザー入力] 
    ↓
[SearchInput.onChange]
    ↓
[SearchService.searchSake(query)]
    ↓ 
[API: /api/search?q=query]
    ↓
[sake_data.json読み込み]
    ↓
[文字列マッチング処理]
    ↓
[結果フィルタリング]
    ↓
[JSON レスポンス]
    ↓
[ChartService.plotSake(results)]
    ↓
[Chart.js グラフ描画]
    ↓
[DetailComponent.show(selectedSake)]
```

### 2. グラフ表示フロー
```
[検索結果データ]
    ↓
[座標変換 (sweetness, richness) → (x, y)]
    ↓
[Chart.js データセット構築]
    ↓
[scatter plot 描画]
    ↓
[ユーザーインタラクション (hover/click)]
    ↓
[詳細情報表示]
```

### 3. エラーハンドリングフロー
```
[API リクエスト]
    ↓
[try-catch エラーキャッチ]
    ↓
[エラータイプ判定]
    ├── ネットワークエラー → リトライ表示
    ├── データ未発見 → "見つかりません"表示
    └── システムエラー → "エラーが発生しました"表示
```

## API仕様設計

### /api/search

```javascript
// Request
GET /api/search?q={query}&limit={limit}

// Parameters
{
  "q": "string",      // 検索クエリ (必須)
  "limit": "number"   // 結果件数 (オプション, デフォルト: 10)
}

// Response (Success)
{
  "success": true,
  "data": [
    {
      "id": "sake_001",
      "name": "獺祭 純米大吟醸",
      "brewery": "旭酒造",
      "sweetness": 2.5,
      "richness": 1.8,
      "description": "フルーティーで上品な香り",
      "price_range": "premium"
    }
  ],
  "total": 1,
  "query": "獺祭"
}

// Response (Error)
{
  "success": false,
  "error": "Invalid query parameter",
  "code": "INVALID_QUERY"
}
```

### /api/suggest

```javascript
// Request
GET /api/suggest?q={partial_query}

// Response
{
  "success": true,
  "suggestions": [
    {
      "id": "sake_001",
      "name": "獺祭 純米大吟醸",
      "brewery": "旭酒造"
    }
  ],
  "query": "獺"
}
```

## パフォーマンス設計

### キャッシュ戦略

```
┌─────────────────────────────────────────┐
│              Cache Strategy             │
├─────────────────────────────────────────┤
│  Browser Cache:                        │
│  ├── Static files: 1 year             │
│  ├── API responses: 1 hour             │
│  └── Images: 1 month                   │
│                                        │
│  CDN Cache:                            │
│  ├── HTML/CSS/JS: 1 day               │
│  ├── JSON data: 1 hour                │
│  └── Images: 1 week                    │
│                                        │
│  Function Cache:                       │
│  ├── Parsed JSON: in-memory           │
│  ├── Search index: startup load       │
│  └── Common queries: 15 minutes       │
└─────────────────────────────────────────┘
```

### レスポンス時間目標

- **初回ページロード**: 3秒以内
- **検索実行**: 1秒以内  
- **グラフ描画**: 500ms以内
- **サジェスト表示**: 200ms以内

## セキュリティ設計

### セキュリティ対策

```
┌─────────────────────────────────────────┐
│            Security Measures            │
├─────────────────────────────────────────┤
│  Input Validation:                     │
│  ├── XSS防止 (HTMLエスケープ)           │
│  ├── SQLインジェクション対策 (N/A)       │
│  └── 入力文字数制限                      │
│                                        │
│  HTTP Security:                        │
│  ├── HTTPS強制                         │
│  ├── CORS設定                          │
│  └── Rate Limiting                     │
│                                        │
│  Data Security:                        │
│  ├── 機密情報なし                       │
│  ├── パブリックデータのみ               │
│  └── ログ記録最小化                      │
└─────────────────────────────────────────┘
```

## 監視・ロギング設計

### メトリクス収集

```
┌─────────────────────────────────────────┐
│              Monitoring                 │
├─────────────────────────────────────────┤
│  Performance Metrics:                  │
│  ├── API response time                 │
│  ├── Page load time                    │
│  ├── Chart rendering time              │
│  └── Error rate                        │
│                                        │
│  Business Metrics:                     │
│  ├── Search queries count              │
│  ├── Popular sake names                │
│  ├── User session duration             │
│  └── Bounce rate                       │
│                                        │
│  Infrastructure:                       │
│  ├── Vercel Function invocations       │
│  ├── CDN hit rate                      │
│  ├── Bandwidth usage                   │
│  └── Storage access patterns           │
└─────────────────────────────────────────┘
```

## 拡張性設計

### 将来の拡張ポイント

```
┌─────────────────────────────────────────┐
│            Scalability Design          │
├─────────────────────────────────────────┤
│  Data Scaling:                         │
│  ├── JSON → Database migration         │
│  ├── Search index optimization         │
│  └── CDN distribution                  │
│                                        │
│  Feature Scaling:                      │
│  ├── User authentication               │
│  ├── Recommendation engine             │
│  ├── Machine learning integration      │
│  └── Mobile app support                │
│                                        │
│  Infrastructure Scaling:               │
│  ├── Microservices architecture        │
│  ├── Container deployment              │
│  ├── Auto-scaling configuration        │
│  └── Multi-region deployment           │
└─────────────────────────────────────────┘
```