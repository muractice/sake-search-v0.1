# 4象限チャート仕様書

## 概要
日本酒の味わいを視覚的に表現するため、さけのわAPIのフレーバーチャートデータを2次元座標（4象限）に変換して表示する。

## 座標軸の定義

### X軸：甘辛度
- **正方向（右）**: 甘口
- **負方向（左）**: 辛口
- **範囲**: -3 〜 +3

### Y軸：淡濃度
- **正方向（上）**: 濃醇
- **負方向（下）**: 淡麗
- **範囲**: -3 〜 +3

## 4象限の分類

```
        濃醇
         ↑
    辛口濃醇 | 甘口濃醇
    （左上） | （右上）
    ---------|----------→ 甘口
    辛口淡麗 | 甘口淡麗
    （左下） | （右下）
         ↓
        淡麗
```

### 各象限の特徴
- **右上（甘口・濃醇）**: 芳醇でコクがあり、まろやかな味わい
- **右下（甘口・淡麗）**: すっきりとした甘さ、軽快な飲み口
- **左上（辛口・濃醇）**: キレがありながら重厚、力強い味わい
- **左下（辛口・淡麗）**: さっぱりとしてキレがある、爽快な味わい

## 変換ロジック

### 入力データ（さけのわAPIフレーバーチャート）
```typescript
interface FlavorChart {
  f1: number; // 華やか度（0〜1）
  f2: number; // 芳醇度（0〜1）
  f3: number; // 重厚度（0〜1）
  f4: number; // 穏やか度（0〜1）
  f5: number; // ドライ度（0〜1）
  f6: number; // 軽快度（0〜1）
}
```

### 変換式

#### 甘辛度（X軸）の計算
```typescript
sweetnessRaw = (f2 × 2) - (f5 × 2)
sweetness = sweetnessRaw × 3
```

**計算根拠**:
- `f2`（芳醇度）: 甘みやまろやかさの指標として使用
- `f5`（ドライ度）: 辛口・キレの指標として使用
- 係数2: 各パラメータの影響を強調
- 係数3: 最終的なスケール調整

#### 淡濃度（Y軸）の計算
```typescript
richnessRaw = (f3 × 2) - (f6 × 2)
richness = richnessRaw × 3
```

**計算根拠**:
- `f3`（重厚度）: 味の濃さ・コクの指標として使用
- `f6`（軽快度）: さっぱり感・軽さの指標として使用
- 係数2: 各パラメータの影響を強調
- 係数3: 最終的なスケール調整

### 正規化処理
```typescript
sweetness = Math.max(-3, Math.min(3, sweetness))
richness = Math.max(-3, Math.min(3, richness))
```
計算結果を-3〜+3の範囲に収める（クリッピング）

## 実装ファイル

### 変換ロジック
- **ファイル**: `/lib/sakenowaApi.ts`
- **関数**: `convertFlavorToCoordinates()`
- **行番号**: 18-36行目

### 表示コンポーネント
- **ファイル**: `/components/TasteChart.tsx`
- **用途**: 4象限チャートのビジュアル表示

## 使用例

### 入力例
```javascript
// 獺祭のフレーバーチャート例
{
  f1: 0.8,  // 華やか度: 高
  f2: 0.7,  // 芳醇度: 高
  f3: 0.4,  // 重厚度: 中
  f4: 0.6,  // 穏やか度: 中高
  f5: 0.3,  // ドライ度: 低
  f6: 0.6   // 軽快度: 中高
}
```

### 変換結果
```javascript
{
  sweetness: 1.2,  // やや甘口
  richness: -0.6   // やや淡麗
}
```
→ 右下象限（甘口・淡麗）に配置

## 調整パラメータ

現在の係数（2, 3）は経験的に決定された値。必要に応じて以下の調整が可能：

1. **差別化係数（現在: 2）**: パラメータ間の差を強調
2. **スケール係数（現在: 3）**: 最終的な座標範囲の調整
3. **クリッピング範囲（現在: ±3）**: チャート表示範囲

## 今後の改善案

1. **機械学習による最適化**: 実際のソムリエ評価との相関を学習
2. **動的係数調整**: 日本酒のカテゴリーごとに係数を変更
3. **追加軸の検討**: 香りの高さなど第3の軸を追加
4. **ユーザーフィードバック**: 評価の妥当性を収集して改善