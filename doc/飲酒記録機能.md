# 飲酒記録機能 - 詳細仕様

## 機能概要
ユーザーが飲んだ日本酒を記録し、飲酒履歴を管理・分析する機能。
MAU向上とデータ蓄積を促進するためのゲーミフィケーション要素を含む。

## 目的
1. **記憶の補完**: 飲んだお酒を忘れないように記録
2. **体験の蓄積**: 感想やシチュエーションを保存
3. **好みの発見**: 飲酒履歴から傾向を把握
4. **エンゲージメント向上**: 継続的なアプリ利用促進

## 機能要件

### 1. クイック記録
**最小限の操作で記録を完了**

#### 記録フロー
1. 検索結果/比較リスト/お気に入りから「記録」ボタン
2. 評価（星1-5）をタップ
3. 完了（2タップで記録完了）

#### 記録項目（必須）
- 日本酒ID/名前
- 記録日時（自動）
- 評価（星1-5）

### 2. 詳細記録
**より詳細な体験を記録**

#### 記録項目（オプション）
- **感想メモ**: フリーテキスト（200文字まで）
- **写真**: 最大3枚
- **飲んだ場所**:
  - 自宅
  - 居酒屋
  - レストラン
  - バー
  - 酒屋（試飲）
  - イベント
  - その他
- **シチュエーション**:
  - 一人で
  - 友人と
  - 家族と
  - 仕事関係
  - デート
  - お祝い
- **料理ペアリング**: タグ形式
  - 刺身
  - 寿司
  - 焼き魚
  - 煮物
  - 揚げ物
  - 肉料理
  - チーズ
  - その他
- **温度**:
  - 冷酒（5-10℃）
  - 常温（15-20℃）
  - ぬる燗（40℃）
  - 熱燗（50℃）
- **購入情報**:
  - 店名
  - 価格

### 3. 記録管理

#### 一覧表示
- **タイムライン形式**: 最新の記録を上に表示
- **カレンダービュー**: 月単位で記録を確認
- **フィルタ機能**:
  - 期間
  - 評価
  - 場所
  - シチュエーション

#### 記録編集
- 後から詳細情報を追加
- 評価の変更
- メモの編集
- 削除機能

### 4. 統計・分析

#### 基本統計
- **総記録数**: 累計飲酒記録数
- **ユニーク銘柄数**: 異なる日本酒の数
- **酒蔵数**: 訪れた酒蔵の数
- **平均評価**: 全記録の平均評価

#### 期間別統計
- **月間記録数**: 月ごとの飲酒記録
- **週間パターン**: 曜日別の傾向
- **季節傾向**: 季節ごとの好み変化

#### ランキング
- **お気に入りTOP10**: 最も高評価の日本酒
- **よく飲む銘柄**: 記録回数ランキング
- **酒蔵ランキング**: 酒蔵別の平均評価

### 5. ゲーミフィケーション

#### バッジシステム
**記録数バッジ**
- 🥉 ビギナー: 10件記録
- 🥈 レギュラー: 50件記録
- 🥇 マスター: 100件記録
- 💎 レジェンド: 500件記録

**銘柄数バッジ**
- 🍶 探求者: 10銘柄
- 🍶🍶 冒険者: 30銘柄
- 🍶🍶🍶 開拓者: 50銘柄
- 🏆 コレクター: 100銘柄

**酒蔵数バッジ**
- 🏠 地元派: 5蔵
- 🗾 旅人: 20蔵
- 🌏 巡礼者: 50蔵

**特別バッジ**
- 🌸 花見酒: 春に10件記録
- 🎆 夏祭り: 夏に10件記録
- 🍁 秋の味覚: 秋に10件記録
- ❄️ 雪見酒: 冬に10件記録
- 📅 毎日記録: 7日連続記録
- 🗓️ 月間マスター: 1ヶ月30件記録

#### 都道府県マップ
- 47都道府県の日本酒制覇状況を可視化
- 訪問済み都道府県をハイライト
- 各県の記録数と代表銘柄表示

#### ストリーク機能
- 連続記録日数のカウント
- 最長ストリーク記録
- ストリークボーナス（連続記録で特典）

## データ構造

### 飲酒記録テーブル
```typescript
interface DrinkingRecord {
  id: string;
  user_id: string;
  sake_id: string;
  sake_name: string;
  sake_brewery: string;
  
  // 必須項目
  rating: number;        // 1-5
  recorded_at: Date;
  
  // オプション項目
  memo?: string;
  photos?: string[];     // 画像URL配列
  location?: string;
  situation?: string;
  food_pairing?: string[];
  temperature?: string;
  purchase_shop?: string;
  purchase_price?: number;
  
  // メタデータ
  created_at: Date;
  updated_at: Date;
}
```

### 統計データ（キャッシュ）
```typescript
interface UserStatistics {
  user_id: string;
  total_records: number;
  unique_sake_count: number;
  brewery_count: number;
  average_rating: number;
  prefecture_map: {
    [prefecture: string]: {
      count: number;
      sake_list: string[];
    }
  };
  badges: string[];
  current_streak: number;
  longest_streak: number;
  last_recorded_at: Date;
}
```

## UI/UX設計

### 記録ボタンの配置
- 検索結果の各アイテムに「記録」ボタン
- 比較リストの各アイテムに「記録」ボタン
- お気に入り一覧に「記録」ボタン
- 詳細画面に大きな「記録」ボタン

### クイック記録モーダル
```
┌─────────────────────────┐
│ 🍶 獺祭 純米大吟醸を記録  │
├─────────────────────────┤
│                         │
│  評価してください         │
│  ⭐⭐⭐⭐⭐              │
│                         │
│ [詳細を追加] [記録する]   │
└─────────────────────────┘
```

### 記録詳細画面
```
┌─────────────────────────┐
│ 📝 飲酒記録              │
├─────────────────────────┤
│ 🍶 獺祭 純米大吟醸        │
│ 📅 2024/01/20           │
│ ⭐⭐⭐⭐☆ (4.0)         │
├─────────────────────────┤
│ 📝 メモ                  │
│ [___________________]   │
├─────────────────────────┤
│ 📍 場所: [選択▼]         │
│ 👥 シーン: [選択▼]       │
│ 🍽️ 料理: [タグ選択]      │
│ 🌡️ 温度: [選択▼]        │
├─────────────────────────┤
│ 📸 写真を追加            │
│ [+][+][+]              │
├─────────────────────────┤
│ [キャンセル] [保存]       │
└─────────────────────────┘
```

### 統計ダッシュボード
```
┌─────────────────────────┐
│ 📊 あなたの飲酒統計       │
├─────────────────────────┤
│ 総記録数: 127件          │
│ 銘柄数: 45種類           │
│ 酒蔵数: 23蔵             │
│ 平均評価: ⭐4.2          │
├─────────────────────────┤
│ 🏆 獲得バッジ            │
│ [🥈][🍶🍶][🌸][📅]      │
├─────────────────────────┤
│ 🗾 都道府県マップ         │
│ [日本地図ビジュアル]      │
│ 制覇: 15/47県            │
├─────────────────────────┤
│ 🔥 現在のストリーク: 5日  │
│ 最長記録: 12日           │
└─────────────────────────┘
```

## 実装優先度

### Phase 1（MVP）
1. クイック記録機能（評価のみ）
2. 記録一覧表示
3. 基本統計表示

### Phase 2
1. 詳細記録機能
2. 記録編集・削除
3. フィルタ・検索機能

### Phase 3
1. バッジシステム
2. 都道府県マップ
3. ストリーク機能

### Phase 4
1. 写真アップロード
2. カレンダービュー
3. 詳細統計・グラフ

## 技術実装メモ

### データベース設計
- Supabase PostgreSQLに`drinking_records`テーブル作成
- RLS（Row Level Security）でユーザー別アクセス制御
- 統計データはリアルタイム集計 or 定期バッチ更新

### パフォーマンス考慮
- 記録一覧はページネーション実装
- 統計データはキャッシュ活用
- 画像はCDN配信 + サムネイル生成

### 通知・リマインダー
- プッシュ通知でストリーク継続を促進
- 週次サマリーメール送信
- バッジ獲得時の祝福アニメーション